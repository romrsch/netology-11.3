### netology-11.3
## Домашнее задание к занятию "11.03 Микросервисы: подходы"

>Вы работаете в крупной компанию, которая строит систему на основе микросервисной архитектуры. 
>Вам как DevOps специалисту необходимо выдвинуть предложение по организации инфраструктуры, для разработки и эксплуатации.

### Задача 1: Обеспечить разработку

>Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.
>Решение должно соответствовать следующим требованиям:

* Облачная система;
* Система контроля версий Git;
* Репозиторий на каждый сервис;
* Запуск сборки по событию из системы контроля версий;
* Запуск сборки по кнопке с указанием параметров;
* Возможность привязать настройки к каждой сборке;
* Возможность создания шаблонов для различных конфигураций сборок;
* Возможность безопасного хранения секретных данных: пароли, ключи доступа;
* Несколько конфигураций для сборки из одного репозитория;
* Кастомные шаги при сборке;
* Собственные докер образы для сборки проектов;
* Возможность развернуть агентов сборки на собственных серверах;
* Возможность параллельного запуска нескольких сборок;
* Возможность параллельного запуска тестов;

Обоснуйте свой выбор.

### Ответ:
Думаю предложить: **Gitlab** и **TeamCity**.

Для  системы управления репозиториями кода для Git выбор был между GitHub и GitLab, но для компании я бы выбрал: GitLab.
С точки зрения размещения проприетарной информации, персональных данных, другой чувствительной информации, преимущество на стороне GitLab, систему можно установить на собственных серверах.

Указанным в задании требованиям он удоавлетворяет:
* Управление публичными и приватными git-репозиториями;
* Управление пользователями и группами, правами доступа к git-репозиториям;
* Облачный хостинг,
* Неограниченное число пользователей, расширенное управление правами, группами,
* Безопасность и конфиденциальность (https с SSL /TLS шифрованием, SSH-ключи для авторизации, можно использовать многофакторную авторизацию)
* Встроенные возможности для CI / CD автоматизации релизов,
* Отслеживание изменений и прогресса, есть треккер задач,

Для сервера обеспечения непрерывной интеграции выбор был между TeamCity и Jenkins. Сравнил эти два ПО, но по условиям задачи как-то склонился в к TeamCity.
Его проще установить и настроить, имеет функцию безопасности по умолчанию, правда в отличие от Jenkins он платный, и не такой распространенный. 

Но TeamCity - также можно рассмотреть как удобный сервер для непрерывной интеграции:

* Совместимость с ключевыми инструментами (система контроля версий, баг-трекер, инструмент сборки и репозиторий пакетов): 
* * Docker, Jira, Visual Studio Team Services, Maven 
* * Совместимость с системами контроля версий VCS (Hub, GitLab, Bitbucket)
* Непрерывная интеграция: 
* * Удаленный запуск тестов и предварительное тестирование коммитов
* * Отображение хода выполнения сборки в реальном времени
* * Упорядочивание тестов по группе риска
* * Управление проблемами и тестами
* Кастомизация: 
* * REST API — простой способ взаимодействия с TeamCity, 
* * Большое количество готовых плагинов (если нет подходящего, то можно сделать свой через  Open API), 
* История сборок, История тестирования, Журнал изменений
* Поддержка нескольких билд-агентов, статистика по билд-агентам
* Резервное копирование и восстановление, а также импорт проектов
* Отчеты о качестве кода непосредственно в IDE
* Шаблоны по умолчанию и использование нескольких шаблонов. ( можно создать шаблон с общими настройками, а затем создавать на его основе любое число конфигураций сборки.)
---
### Задача 2: Логи

> Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре. 
> Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.
> Решение должно соответствовать следующим требованиям:

* Сбор логов в центральное хранилище со всех хостов обслуживающих систему;
* Минимальные требования к приложениям, сбор логов из stdout;
* Гарантированная доставка логов до центрального хранилища;
* Обеспечение поиска и фильтрации по записям логов;
* Обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
* Возможность дать ссылку на сохраненный поиск по записям логов;

Обоснуйте свой выбор.

### Ответ:
Предложу, то что ранее изучили на курсе: стек Elasticsearch, Logstash, Kibana (ELK). 

Состав комплекса:
- **FileBeat** - агент, собирающий данные с машины и направляющий в Elasticsearch
- **Elasticsearch** - поисковая система, предназначенная для поиска фрагментов текста, с гибким функционалом и широкими возможностями по настройке.
- **Logstash** - приложение для сбора информации из различных источников, преобразования их в удобный для работы формат и направления их в хранилище для дальнейшей работы.
- **Kibana** - это плагин, предназначенный специально для Elasticsearch. Он отвечает за визуализацию данных, аналитику и представление итоговой информации в удобном для восприятия виде.

Возможности ELK удовлетворяют тредованиям задачи:
* *Масштабируемость* — кластер Elasticsearch (ES) расширяется «на лету» добавлением новых серверов. При этом распределение нагрузки по узлам происходит автоматически.
* *Отказоустойчивость* — в случае сбоя кластерных узлов данные не потеряются, а будут перераспределены, и поисковая система сама продолжит работу.
* *Гибкость* поисковых фильтров, можно динамически организовать несколько различных поисковых систем.
* *Управляемость* ES по HTTP с помощью JSON-запросов за счет REST API и визуального веб-интерфейса Kibana.
* *Универсальность* — Logsatsh в потоковом режиме работает одновременно со множеством разных источников данных (СУБД, файлы, системные логи, веб-приложения и пр.), фильтруя и преобразуя их для отправки в хранилище ES автоматически индексируются и добавляются в базу поиска.

Правда *ELK* имеет высокое потребление ресурсов и проблемы с информационной безопасностью.

---
### Задача 3: Мониторинг

>Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре. 
> Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.
> Решение должно соответствовать следующим требованиям:

* Сбор метрик со всех хостов, обслуживающих систему;
* Сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
* Сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
* Сбор метрик, специфичных для каждого сервиса;
* Пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
* Пользовательский интерфейс с возможность настраивать различные панели для отслеживания состояния системы;

Обоснуйте свой выбор.

### Ответ:

Для мониторинга применим (наверное, самое распространенное решение) - это **Prometheus** и **Grafana**. 

Состав:
**Prometheus** -  набор инструментов для мониторинга и оповещения систем с открытым исходным кодом,  собирает и хранит  метрики в виде  временных рядов, т.е. информация о метриках хранится с меткой времени, в которую она была записана
**Grafana** - веб-интерфейс для работы с данными , строит на оперативных данных графики. 

Позволяет визуализировать данные с систем мониторинга и большого числа разных метрик, в том числе с большинства источников данных, так же совместима с Elasticsearch, который рекомендован в задаче 2, для хранения логов, создавая удобный комплекс. Является практически стандартом при использовании микросервисов. 

**Преимущества**: 
Настраиваемая визуализация (Grafana), простое управление, интеграция с различными системами и источниками данных, широкое использовние, имеет возможность создания достаточно гибких запросов в том числе с агрегацией и выборкой (которые не реализуемы внутри Kibana).

